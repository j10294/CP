library(ggplot2)
library(patchwork)  # ì—¬ëŸ¬ ê°œ ê·¸ë˜í”„ í•œ ë²ˆì— ë¬¶ì„ë•Œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬


# monte_carlo_results ë¥¼ ë°›ì•˜ë‹¤ê³  ê°€ì •

# ğŸ“£ Figure 3 
plot_figure3 <- function(monte_carlo_results, nominal_coverage = 0.95) {
  
  plot_list <- list()
  
  for (name in names(monte_carlo_results)) {
    df <- monte_carlo_results[[name]]
    
    # ëª¨ë¸, ìƒ˜í”Œì‚¬ì´ì¦ˆ ì •ë³´ ì¶”ì¶œ
    model_num <- as.integer(sub("Model_(\\d+)_m_.*", "\\1", name))
    sample_size <- as.integer(sub(".*_m_(\\d+)", "\\1", name))
    
    p <- ggplot(df, aes(x = x, y = coverage_probabilities)) +
      geom_point(size = 1.2, color = "red") +
      geom_hline(yintercept = nominal_coverage, linetype = "dashed", color = "black", size = 1) +
      ylim(0.7, 1) +
      labs(
        title = paste0("Model ", model_num, ", Sample Size = ", sample_size),
        x = "x",
        y = "Coverage Probability"
      ) +
      theme_bw(base_size = 14)
    
    plot_list[[name]] <- p
  }
  
  # patchwork ë¡œ gridë¡œ í•©ì¹˜ê¸°
  combined_plot <- wrap_plots(plot_list, ncol = 3)  # 3ê°œì”© ê°€ë¡œë¡œ
  
  return(combined_plot)
}

